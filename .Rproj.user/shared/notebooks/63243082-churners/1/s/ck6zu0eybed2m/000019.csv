"0","## auc(myRoc)"
"0","#kappa = .76, AUC  = .97"
"0",""
"0",""
"0","#with only top 5 variables "
"0",""
"0","banksy2 = bank %>% select(total_amt_chng_q4_q1, total_trans_ct, total_trans_amt,total_revolving_bal, total_relationship_count,churn)"
"0",""
"0","bank_index2 <- createDataPartition(banksy2$churn, p = 0.80, list = FALSE)"
"0","train2 <- banksy2[ bank_index2, ]"
"0","test2 <- banksy2[-bank_index2, ]"
"0",""
"0","fit_gbm2 <- train(churn ~ .,"
"0","             data = train2, "
"0","             method = ""gbm"","
"0","             tuneLength = 4, "
"0","             preProcess = c(""center"",""scale""),"
"0","             metric = ""ROC"","
"0","             trControl = ctrl)"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8467             nan     0.1000    0.0166
"
"1","     2        0.8216             nan     0.1000    0.0132
"
"1","     3        0.7986             nan     0.1000    0.0115
"
"1","     4        0.7787             nan     0.1000    0.0100
"
"1","     5        0.7626             nan     0.1000    0.0085
"
"1","     6        0.7480             nan     0.1000    0.0067
"
"1","     7        0.7319             nan     0.1000    0.0081
"
"1","     8        0.7184             nan     0.1000    0.0067
"
"1","     9        0.7067             nan     0.1000    0.0052
"
"1","    10        0.6977             nan     0.1000    0.0040
"
"1","    20        0.6350             nan     0.1000    0.0026
"
"1","    40        0.5637             nan     0.1000    0.0010
"
"1","    60        0.5192             nan     0.1000    0.0006
"
"1","    80        0.4802             nan     0.1000    0.0005
"
"1","   100        0.4473             nan     0.1000    0.0004
"
"1","   120        0.4183             nan     0.1000    0.0002
"
"1","   140        0.3961             nan     0.1000    0.0002
"
"1","   160        0.3782             nan     0.1000    0.0000
"
"1","   180        0.3617             nan     0.1000    0.0002
"
"1","   200        0.3494             nan     0.1000    0.0001
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8192             nan     0.1000    0.0323
"
"1","     2        0.7780             nan     0.1000    0.0218
"
"1","     3        0.7442             nan     0.1000    0.0169
"
"1","     4        0.7174             nan     0.1000    0.0137
"
"1","     5        0.6973             nan     0.1000    0.0093
"
"1","     6        0.6748             nan     0.1000    0.0108
"
"1","     7        0.6594             nan     0.1000    0.0070
"
"1","     8        0.6393             nan     0.1000    0.0100
"
"1","     9        0.6277             nan     0.1000    0.0051
"
"1","    10        0.6140             nan     0.1000    0.0066
"
"1","    20        0.5315             nan     0.1000    0.0027
"
"1","    40        0.4101             nan     0.1000    0.0015
"
"1","    60        0.3475             nan     0.1000    0.0010
"
"1","    80        0.3141             nan     0.1000    0.0002
"
"1","   100        0.2889             nan     0.1000    0.0003
"
"1","   120        0.2668             nan     0.1000    0.0002
"
"1","   140        0.2503             nan     0.1000    0.0001
"
"1","   160        0.2352             nan     0.1000    0.0002
"
"1","   180        0.2258             nan     0.1000    0.0001
"
"1","   200        0.2177             nan     0.1000    0.0000
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8072             nan     0.1000    0.0364
"
"1","     2        0.7560             nan     0.1000    0.0233
"
"1","     3        0.7168             nan     0.1000    0.0173
"
"1","     4        0.6820             nan     0.1000    0.0168
"
"1","     5        0.6552             nan     0.1000    0.0124
"
"1","     6        0.6320             nan     0.1000    0.0112
"
"1","     7        0.6104             nan     0.1000    0.0104
"
"1","     8        0.5934             nan     0.1000    0.0078
"
"1","     9        0.5789             nan     0.1000    0.0072
"
"1","    10        0.5640             nan     0.1000    0.0065
"
"1","    20        0.4660             nan     0.1000    0.0086
"
"1","    40        0.3430             nan     0.1000    0.0012
"
"1","    60        0.2922             nan     0.1000    0.0002
"
"1","    80        0.2613             nan     0.1000    0.0001
"
"1","   100        0.2371             nan     0.1000   -0.0000
"
"1","   120        0.2192             nan     0.1000   -0.0000
"
"1","   140        0.2084             nan     0.1000   -0.0001
"
"1","   160        0.1975             nan     0.1000    0.0001
"
"1","   180        0.1881             nan     0.1000   -0.0000
"
"1","   200        0.1799             nan     0.1000   -0.0000
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8054             nan     0.1000    0.0395
"
"1","     2        0.7540             nan     0.1000    0.0258
"
"1","     3        0.7163             nan     0.1000    0.0182
"
"1","     4        0.6838             nan     0.1000    0.0164
"
"1","     5        0.6522             nan     0.1000    0.0140
"
"1","     6        0.6284             nan     0.1000    0.0113
"
"1","     7        0.6030             nan     0.1000    0.0119
"
"1","     8        0.5818             nan     0.1000    0.0101
"
"1","     9        0.5634             nan     0.1000    0.0089
"
"1","    10        0.5433             nan     0.1000    0.0086
"
"1","    20        0.4268             nan     0.1000    0.0029
"
"1","    40        0.3126             nan     0.1000    0.0014
"
"1","    60        0.2585             nan     0.1000    0.0005
"
"1","    80        0.2292             nan     0.1000    0.0000
"
"1","   100        0.2079             nan     0.1000    0.0000
"
"1","   120        0.1940             nan     0.1000    0.0000
"
"1","   140        0.1829             nan     0.1000   -0.0001
"
"1","   160        0.1746             nan     0.1000   -0.0001
"
"1","   180        0.1662             nan     0.1000   -0.0001
"
"1","   200        0.1589             nan     0.1000    0.0001
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8467             nan     0.1000    0.0168
"
"1","     2        0.8212             nan     0.1000    0.0128
"
"1","     3        0.7963             nan     0.1000    0.0125
"
"1","     4        0.7757             nan     0.1000    0.0092
"
"1","     5        0.7585             nan     0.1000    0.0092
"
"1","     6        0.7434             nan     0.1000    0.0071
"
"1","     7        0.7277             nan     0.1000    0.0076
"
"1","     8        0.7158             nan     0.1000    0.0057
"
"1","     9        0.7022             nan     0.1000    0.0063
"
"1","    10        0.6910             nan     0.1000    0.0054
"
"1","    20        0.6232             nan     0.1000    0.0029
"
"1","    40        0.5513             nan     0.1000    0.0013
"
"1","    60        0.5094             nan     0.1000    0.0006
"
"1","    80        0.4722             nan     0.1000    0.0005
"
"1","   100        0.4448             nan     0.1000    0.0004
"
"1","   120        0.4192             nan     0.1000    0.0005
"
"1","   140        0.3965             nan     0.1000    0.0003
"
"1","   160        0.3783             nan     0.1000    0.0006
"
"1","   180        0.3624             nan     0.1000    0.0006
"
"1","   200        0.3487             nan     0.1000    0.0002
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8154             nan     0.1000    0.0316
"
"1","     2        0.7752             nan     0.1000    0.0203
"
"1","     3        0.7389             nan     0.1000    0.0173
"
"1","     4        0.7128             nan     0.1000    0.0129
"
"1","     5        0.6923             nan     0.1000    0.0094
"
"1","     6        0.6697             nan     0.1000    0.0109
"
"1","     7        0.6564             nan     0.1000    0.0066
"
"1","     8        0.6391             nan     0.1000    0.0083
"
"1","     9        0.6289             nan     0.1000    0.0048
"
"1","    10        0.6149             nan     0.1000    0.0066
"
"1","    20        0.5307             nan     0.1000    0.0015
"
"1","    40        0.4174             nan     0.1000    0.0011
"
"1","    60        0.3652             nan     0.1000    0.0011
"
"1","    80        0.3206             nan     0.1000    0.0008
"
"1","   100        0.2909             nan     0.1000    0.0003
"
"1","   120        0.2691             nan     0.1000    0.0002
"
"1","   140        0.2514             nan     0.1000   -0.0001
"
"1","   160        0.2366             nan     0.1000    0.0004
"
"1","   180        0.2259             nan     0.1000    0.0000
"
"1","   200        0.2173             nan     0.1000    0.0000
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8078             nan     0.1000    0.0386
"
"1","     2        0.7587             nan     0.1000    0.0243
"
"1","     3        0.7202             nan     0.1000    0.0190
"
"1","     4        0.6891             nan     0.1000    0.0157
"
"1","     5        0.6656             nan     0.1000    0.0113
"
"1","     6        0.6426             nan     0.1000    0.0109
"
"1","     7        0.6193             nan     0.1000    0.0112
"
"1","     8        0.6000             nan     0.1000    0.0079
"
"1","     9        0.5838             nan     0.1000    0.0075
"
"1","    10        0.5675             nan     0.1000    0.0083
"
"1","    20        0.4644             nan     0.1000    0.0039
"
"1","    40        0.3479             nan     0.1000    0.0029
"
"1","    60        0.2944             nan     0.1000    0.0003
"
"1","    80        0.2586             nan     0.1000    0.0006
"
"1","   100        0.2361             nan     0.1000    0.0001
"
"1","   120        0.2199             nan     0.1000    0.0000
"
"1","   140        0.2079             nan     0.1000   -0.0001
"
"1","   160        0.1971             nan     0.1000   -0.0002
"
"1","   180        0.1892             nan     0.1000   -0.0000
"
"1","   200        0.1824             nan     0.1000   -0.0001
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8009             nan     0.1000    0.0420
"
"1","     2        0.7486             nan     0.1000    0.0245
"
"1","     3        0.7013             nan     0.1000    0.0211
"
"1","     4        0.6671             nan     0.1000    0.0153
"
"1","     5        0.6368             nan     0.1000    0.0142
"
"1","     6        0.6118             nan     0.1000    0.0114
"
"1","     7        0.5879             nan     0.1000    0.0107
"
"1","     8        0.5655             nan     0.1000    0.0095
"
"1","     9        0.5489             nan     0.1000    0.0077
"
"1","    10        0.5320             nan     0.1000    0.0079
"
"1","    20        0.4171             nan     0.1000    0.0041
"
"1","    40        0.3101             nan     0.1000    0.0013
"
"1","    60        0.2567             nan     0.1000    0.0004
"
"1","    80        0.2321             nan     0.1000    0.0001
"
"1","   100        0.2105             nan     0.1000   -0.0002
"
"1","   120        0.1953             nan     0.1000   -0.0001
"
"1","   140        0.1846             nan     0.1000   -0.0001
"
"1","   160        0.1768             nan     0.1000   -0.0002
"
"1","   180        0.1695             nan     0.1000   -0.0002
"
"1","   200        0.1623             nan     0.1000   -0.0001
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8439             nan     0.1000    0.0177
"
"1","     2        0.8182             nan     0.1000    0.0135
"
"1","     3        0.7932             nan     0.1000    0.0122
"
"1","     4        0.7715             nan     0.1000    0.0106
"
"1","     5        0.7537             nan     0.1000    0.0086
"
"1","     6        0.7357             nan     0.1000    0.0087
"
"1","     7        0.7206             nan     0.1000    0.0067
"
"1","     8        0.7095             nan     0.1000    0.0053
"
"1","     9        0.6963             nan     0.1000    0.0069
"
"1","    10        0.6851             nan     0.1000    0.0055
"
"1","    20        0.6165             nan     0.1000    0.0034
"
"1","    40        0.5446             nan     0.1000    0.0012
"
"1","    60        0.4991             nan     0.1000    0.0007
"
"1","    80        0.4644             nan     0.1000    0.0007
"
"1","   100        0.4339             nan     0.1000    0.0005
"
"1","   120        0.4091             nan     0.1000    0.0003
"
"1","   140        0.3870             nan     0.1000    0.0009
"
"1","   160        0.3694             nan     0.1000    0.0007
"
"1","   180        0.3536             nan     0.1000    0.0002
"
"1","   200        0.3389             nan     0.1000    0.0005
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8149             nan     0.1000    0.0349
"
"1","     2        0.7703             nan     0.1000    0.0222
"
"1","     3        0.7315             nan     0.1000    0.0192
"
"1","     4        0.7033             nan     0.1000    0.0141
"
"1","     5        0.6797             nan     0.1000    0.0115
"
"1","     6        0.6612             nan     0.1000    0.0086
"
"1","     7        0.6409             nan     0.1000    0.0096
"
"1","     8        0.6282             nan     0.1000    0.0060
"
"1","     9        0.6167             nan     0.1000    0.0054
"
"1","    10        0.6003             nan     0.1000    0.0074
"
"1","    20        0.5183             nan     0.1000    0.0022
"
"1","    40        0.4026             nan     0.1000    0.0017
"
"1","    60        0.3488             nan     0.1000    0.0009
"
"1","    80        0.3055             nan     0.1000    0.0006
"
"1","   100        0.2768             nan     0.1000    0.0006
"
"1","   120        0.2567             nan     0.1000    0.0001
"
"1","   140        0.2402             nan     0.1000    0.0002
"
"1","   160        0.2288             nan     0.1000    0.0001
"
"1","   180        0.2195             nan     0.1000   -0.0002
"
"1","   200        0.2094             nan     0.1000   -0.0001
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.7992             nan     0.1000    0.0398
"
"1","     2        0.7478             nan     0.1000    0.0247
"
"1","     3        0.7071             nan     0.1000    0.0197
"
"1","     4        0.6771             nan     0.1000    0.0149
"
"1","     5        0.6480             nan     0.1000    0.0136
"
"1","     6        0.6238             nan     0.1000    0.0118
"
"1","     7        0.6019             nan     0.1000    0.0101
"
"1","     8        0.5829             nan     0.1000    0.0084
"
"1","     9        0.5673             nan     0.1000    0.0068
"
"1","    10        0.5550             nan     0.1000    0.0053
"
"1","    20        0.4559             nan     0.1000    0.0057
"
"1","    40        0.3398             nan     0.1000    0.0033
"
"1","    60        0.2847             nan     0.1000    0.0011
"
"1","    80        0.2527             nan     0.1000    0.0004
"
"1","   100        0.2297             nan     0.1000    0.0002
"
"1","   120        0.2117             nan     0.1000    0.0003
"
"1","   140        0.1983             nan     0.1000   -0.0000
"
"1","   160        0.1870             nan     0.1000    0.0000
"
"1","   180        0.1791             nan     0.1000   -0.0001
"
"1","   200        0.1706             nan     0.1000   -0.0000
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.7974             nan     0.1000    0.0407
"
"1","     2        0.7413             nan     0.1000    0.0272
"
"1","     3        0.6988             nan     0.1000    0.0214
"
"1","     4        0.6671             nan     0.1000    0.0153
"
"1","     5        0.6362             nan     0.1000    0.0146
"
"1","     6        0.6138             nan     0.1000    0.0106
"
"1","     7        0.5930             nan     0.1000    0.0105
"
"1","     8        0.5684             nan     0.1000    0.0111
"
"1","     9        0.5491             nan     0.1000    0.0089
"
"1","    10        0.5314             nan     0.1000    0.0088
"
"1","    20        0.4239             nan     0.1000    0.0036
"
"1","    40        0.3073             nan     0.1000    0.0011
"
"1","    60        0.2541             nan     0.1000    0.0005
"
"1","    80        0.2262             nan     0.1000    0.0003
"
"1","   100        0.2058             nan     0.1000    0.0000
"
"1","   120        0.1888             nan     0.1000    0.0000
"
"1","   140        0.1787             nan     0.1000   -0.0001
"
"1","   160        0.1687             nan     0.1000    0.0002
"
"1","   180        0.1615             nan     0.1000   -0.0001
"
"1","   200        0.1540             nan     0.1000   -0.0002
"
"1","
"
"1","Iter   TrainDeviance   ValidDeviance   StepSize   Improve
"
"1","     1        0.8034             nan     0.1000    0.0404
"
"1","     2        0.7489             nan     0.1000    0.0272
"
"1","     3        0.7089             nan     0.1000    0.0205
"
"1","     4        0.6773             nan     0.1000    0.0156
"
"1","     5        0.6500             nan     0.1000    0.0131
"
"1","     6        0.6251             nan     0.1000    0.0120
"
"1","     7        0.6002             nan     0.1000    0.0123
"
"1","     8        0.5800             nan     0.1000    0.0098
"
"1","     9        0.5616             nan     0.1000    0.0080
"
"1","    10        0.5435             nan     0.1000    0.0082
"
"1","    20        0.4320             nan     0.1000    0.0030
"
"1","    40        0.3155             nan     0.1000    0.0011
"
"1","    60        0.2638             nan     0.1000    0.0013
"
"1","    80        0.2342             nan     0.1000    0.0001
"
"1","   100        0.2144             nan     0.1000    0.0000
"
"1","   120        0.2008             nan     0.1000   -0.0002
"
"1","   140        0.1906             nan     0.1000    0.0000
"
"1","   160        0.1836             nan     0.1000   -0.0000
"
"1","   180        0.1762             nan     0.1000    0.0000
"
"1","   200        0.1711             nan     0.1000   -0.0001
"
"1","
"
"0","confusionMatrix(predict(fit_gbm2, test2),factor(test2$churn))"
"1","Confusion Matrix and Statistics

"
"1","          Reference
"
"1","Prediction"
"1","   no"
"1","  yes"
"1","
       no "
"1"," 1673"
"1","   56"
"1","
       yes"
"1","   27"
"1","  269"
"1","
"
"1",""
"1","                         "
"1","                 "
"1","
"
"1","               Accuracy :"
"1"," 0.959           "
"1","
"
"1","                 95% CI :"
"1"," (0.9494, 0.9672)"
"1","
"
"1","    No Information Rate :"
"1"," 0.8395          "
"1","
"
"1","    P-Value [Acc > NIR] :"
"1"," < 2.2e-16       "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","                  Kappa :"
"1"," 0.8422          "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1"," Mcnemar's Test P-Value :"
"1"," 0.002116        "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","            Sensitivity :"
"1"," 0.9841          "
"1","
"
"1","            Specificity :"
"1"," 0.8277          "
"1","
"
"1","         Pos Pred Value :"
"1"," 0.9676          "
"1","
"
"1","         Neg Pred Value :"
"1"," 0.9088          "
"1","
"
"1","             Prevalence :"
"1"," 0.8395          "
"1","
"
"1","         Detection Rate :"
"1"," 0.8262          "
"1","
"
"1","   Detection Prevalence :"
"1"," 0.8538          "
"1","
"
"1","      Balanced Accuracy :"
"1"," 0.9059          "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","       'Positive' Class :"
"1"," no              "
"1","
"
"1","                         "
"1","                 "
"1","
"
"0","myRoc <- roc(test2$churn, predict(fit_gbm2, test2, type=""prob"")[,2])"
"2","Setting levels: control = no, case = yes
"
"2","Setting direction: controls < cases
"
"0","plot(myRoc)"
